<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng C·∫£nh B√°o Ch√°y Th√¥ng Minh</title>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #d32f2f;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 20px;
            max-width: 800px; 
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }

        /* CARD STYLE */
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Card full chi·ªÅu r·ªông cho SƒêT */
        .full-width {
            grid-column: 1 / -1;
        }
        @media (max-width: 768px) { .full-width { grid-column: span 1; } }

        .card h2 {
            font-size: 16px;
            color: #888;
            margin-top: 0;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .value-display {
            font-size: 42px;
            font-weight: bold;
            color: #333;
            margin: 5px 0;
        }

        .status-text {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        /* ALERT MODE */
        .alert-mode {
            background-color: #ff4d4d !important;
            color: white !important;
            animation: pulse 1s infinite;
        }
        .alert-mode h2, .alert-mode .value-display, .alert-mode .status-text, .alert-mode .threshold-box div {
            color: white !important;
        }
        .alert-mode input {
            color: #333 !important; 
            background-color: #fff !important;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* INPUT & BUTTON */
        .control-group {
            margin-top: auto;
            padding-top: 15px;
        }
        input {
            width: 60%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            outline: none;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: 0.3s;
        }
        button:hover { background-color: #0056b3; }

        /* STATUS BADGE */
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            color: white;
            margin-bottom: 20px;
            transition: 0.3s;
        }
        .status-online { background-color: #28a745; box-shadow: 0 0 10px #28a745; }
        .status-offline { background-color: #dc3545; box-shadow: 0 0 10px #dc3545; }
        
    </style>
</head>
<body>

    <h1>üî• H·ªá Th·ªëng Gi√°m S√°t An To√†n</h1>
    
    <div style="text-align: center;">
        <span id="connectionStatus" class="status-badge status-offline">üî¥ ƒêang t√¨m thi·∫øt b·ªã...</span>
    </div>
    
    <div class="container">
        
        <div class="card" id="tempCard">
            <h2>üå° Nhi·ªát ƒë·ªô</h2>
            <div class="value-display" id="tempValue">-- ¬∞C</div>
            <div class="status-text" id="tempStatus">ƒêang t·∫£i...</div>
        </div>

        <div class="card" id="smokeCard">
            <h2>üí® Kh√≥i</h2>
            <div class="value-display" id="smokeValue">-- ppm</div>
            <div class="status-text" id="smokeStatus">ƒêang t·∫£i...</div>
        </div>

        <div class="card" id="gasCard">
            <h2>‚ò† Gas</h2>
            <div class="value-display" id="gasValue">-- ppm</div>
            <div class="status-text" id="gasStatus">ƒêang t·∫£i...</div>
        </div>

        <div class="card" id="flameCard">
            <h2>üî• L·ª≠a</h2>
            <div class="value-display" id="flameValue">--</div>
            <div class="status-text" id="flameStatus">ƒêang t·∫£i...</div>
        </div>

        <div class="card full-width">
            <h2>üìû S·ªë ƒëi·ªán tho·∫°i kh·∫©n c·∫•p</h2>
            <div style="margin-bottom:10px;">Hi·ªán t·∫°i: <b id="currPhone" style="color:blue; font-size: 18px;">--</b></div>
            <div class="control-group">
                <input type="text" id="newPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i (10 s·ªë)...">
                <button onclick="updatePhone()">L∆∞u SƒêT</button>
            </div>
        </div>

        <div class="card">
            <h2>‚öô Ng∆∞·ª°ng Nhi·ªát</h2>
            <div style="margin-bottom: 10px;">Hi·ªán t·∫°i: <b id="thresTemp" style="color: red;">--</b></div>
            <div class="control-group">
                <input type="number" id="newThresTemp" placeholder="Nh·∫≠p m·ª©c c·∫£nh b√°o...">
                <button onclick="updateThreshold()">L∆∞u</button>
            </div>
        </div>

        <div class="card">
            <h2>‚öô Ng∆∞·ª°ng Kh√≥i</h2>
            <div style="margin-bottom: 10px;">Hi·ªán t·∫°i: <b id="thresSmoke" style="color: red;">--</b></div>
            <div class="control-group">
                <input type="number" id="newThresSmoke" placeholder="Nh·∫≠p m·ª©c c·∫£nh b√°o...">
                <button onclick="updateSmokeThreshold()">L∆∞u</button>
            </div>
        </div>

        <div class="card">
            <h2>‚öô Ng∆∞·ª°ng Gas</h2>
            <div style="margin-bottom: 10px;">Hi·ªán t·∫°i: <b id="thresGas" style="color: red;">--</b></div>
            <div class="control-group">
                <input type="number" id="newThresGas" placeholder="Nh·∫≠p m·ª©c c·∫£nh b√°o...">
                <button onclick="updateGasThreshold()">L∆∞u</button>
            </div>
        </div>

        <div class="card">
            <h2>‚öô Ng∆∞·ª°ng L·ª≠a</h2>
            <div style="margin-bottom: 10px;">Hi·ªán t·∫°i: <b id="thresFlame" style="color: red;">--</b></div>
            <div class="control-group">
                <input type="number" id="newThresFlame" placeholder="Nh·∫≠p m·ª©c c·∫£nh b√°o...">
                <button onclick="updateFlameThreshold()">L∆∞u</button>
            </div>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAAoqP-5Kkw_sMJOvLzMd9yMZsto86rQBk",
            authDomain: "fire-warning-3f43e.firebaseapp.com",
            databaseURL: "https://fire-warning-3f43e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fire-warning-3f43e",
            storageBucket: "fire-warning-3f43e.firebasestorage.app",
            messagingSenderId: "216206579900",
            appId: "1:216206579900:web:aa5f46d236923b921418b9"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- BI·∫æN LOGIC ---
        let data = { temp:0, smoke:0, gas:0, flame:0 };
        let limits = { temp:100, smoke:100, gas:100, flame:100 };
        let lastUpdate = 0;
        const timeoutLimit = 12000;

        // --- H√ÄM C·∫¨P NH·∫¨T UI ---
        function updateUI(type, val, limit, cardId, statusId, unit) {
            let card = document.getElementById(cardId);
            let status = document.getElementById(statusId);
            
            document.getElementById(type + "Value").innerText = val + (unit ? " " + unit : "");
            
            // L·ª≠a: < Limit l√† ch√°y. C√°c c√°i kh√°c: >= Limit l√† ch√°y
            let isAlert = (type === 'flame') ? (val < limit) : (val >= limit);

            if(isAlert) {
                card.classList.add("alert-mode");
                status.innerText = "‚ö†Ô∏è NGUY HI·ªÇM !!!";
            } else {
                card.classList.remove("alert-mode");
                status.innerText = "B√¨nh th∆∞·ªùng";
            }
        }

        // --- L·∫ÆNG NGHE D·ªÆ LI·ªÜU ---
        db.ref("Temperature").on("value", snap => {
            data.temp = snap.val() || 0;
            updateUI('temp', data.temp, limits.temp, 'tempCard', 'tempStatus', '¬∞C');
            lastUpdate = Date.now();
        });
        db.ref("Smoke").on("value", snap => {
            data.smoke = snap.val() || 0;
            updateUI('smoke', data.smoke, limits.smoke, 'smokeCard', 'smokeStatus', 'ppm');
            lastUpdate = Date.now();
        });
        db.ref("Gas").on("value", snap => {
            data.gas = snap.val() || 0;
            updateUI('gas', data.gas, limits.gas, 'gasCard', 'gasStatus', 'ppm');
            lastUpdate = Date.now();
        });
        db.ref("Flame").on("value", snap => {
            data.flame = snap.val() || 0;
            updateUI('flame', data.flame, limits.flame, 'flameCard', 'flameStatus', '');
            lastUpdate = Date.now();
        });

        // --- L·∫ÆNG NGHE NG∆Ø·ª†NG & SƒêT ---
        db.ref("PhoneNumber").on("value", snap => {
            document.getElementById("currPhone").innerText = snap.val() || "Ch∆∞a c√≥";
        });

        db.ref("Threshold").on("value", snap => {
            limits.temp = snap.val();
            document.getElementById("thresTemp").innerText = limits.temp;
            updateUI('temp', data.temp, limits.temp, 'tempCard', 'tempStatus', '¬∞C');
        });
        db.ref("SmokeThreshold").on("value", snap => {
            limits.smoke = snap.val();
            document.getElementById("thresSmoke").innerText = limits.smoke;
            updateUI('smoke', data.smoke, limits.smoke, 'smokeCard', 'smokeStatus', 'ppm');
        });
        db.ref("GasThreshold").on("value", snap => {
            limits.gas = snap.val();
            document.getElementById("thresGas").innerText = limits.gas;
            updateUI('gas', data.gas, limits.gas, 'gasCard', 'gasStatus', 'ppm');
        });
        db.ref("FlameThreshold").on("value", snap => {
            limits.flame = snap.val();
            document.getElementById("thresFlame").innerText = limits.flame;
            updateUI('flame', data.flame, limits.flame, 'flameCard', 'flameStatus', '');
        });

        // --- H√ÄM C·∫¨P NH·∫¨T S·ªê ƒêI·ªÜN THO·∫†I (REGEX) ---
        function updatePhone() {
            let val = document.getElementById("newPhone").value;
            const regex = /^\d{10}$/; // Ch·ªâ cho ph√©p 10 s·ªë

            if (regex.test(val)) {
                db.ref("PhoneNumber").set(val);
                alert("‚úÖ ƒê√£ l∆∞u s·ªë ƒëi·ªán tho·∫°i m·ªõi!");
                document.getElementById("newPhone").value = "";
            } else {
                alert("‚ùå L·ªói: S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ ƒë√∫ng 10 ch·ªØ s·ªë!");
            }
        }

        // --- C√ÅC H√ÄM C·∫¨P NH·∫¨T NG∆Ø·ª†NG ---
        function updateThreshold() {
            let val = document.getElementById("newThreshold").value;
            if(val) { db.ref("Threshold").set(Number(val)); alert("ƒê√£ l∆∞u!"); document.getElementById("newThreshold").value = ""; }
        }
        function updateSmokeThreshold() {
            let val = document.getElementById("newSmokeThres").value;
            if(val) { db.ref("SmokeThreshold").set(Number(val)); alert("ƒê√£ l∆∞u!"); document.getElementById("newSmokeThres").value = ""; }
        }
        function updateGasThreshold() {
            let val = document.getElementById("newGasThres").value;
            if(val) { db.ref("GasThreshold").set(Number(val)); alert("ƒê√£ l∆∞u!"); document.getElementById("newGasThres").value = ""; }
        }
        function updateFlameThreshold() {
            let val = document.getElementById("newFlameThres").value;
            if(val) { db.ref("FlameThreshold").set(Number(val)); alert("ƒê√£ l∆∞u!"); document.getElementById("newFlameThres").value = ""; }
        }

        // --- HEARTBEAT CHECK ---
        function updateConnectionStatus() {
            let now = Date.now();
            let badge = document.getElementById("connectionStatus");
            if (now - lastUpdate < timeoutLimit) {
                if (badge.innerText !== "üü¢ ƒêang k·∫øt n·ªëi") {
                    badge.className = "status-badge status-online";
                    badge.innerText = "üü¢ ƒêang k·∫øt n·ªëi";
                }
            } else {
                if (badge.innerText !== "üî¥ M·∫•t k·∫øt n·ªëi (Offline)") {
                    badge.className = "status-badge status-offline";
                    badge.innerText = "üî¥ M·∫•t k·∫øt n·ªëi (Offline)";
                }
            }
        }
        setInterval(updateConnectionStatus, 1000);

    </script>
</body>
</html>
