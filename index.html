<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Fire Warning Dashboard</title>

<!-- ChartJS for realtime graph -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #eef2f3;
    }
    .card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        max-width: 600px;
    }
    .alert {
        animation: blink 0.7s infinite alternate;
        background-color: #ffb3b3 !important;
        border-left: 8px solid red;
    }
    @keyframes blink {
        from { background-color: #ffd6d6; }
        to { background-color: #ff9b9b; }
    }
    h2 { margin-top: 0; }
    input, button {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        font-size: 16px;
    }
    button {
        background-color: #007bff;
        color: white;
        cursor: pointer;
        border-radius: 8px;
        border: none;
    }
</style>
</head>

<body>

<h1 style="font-size:32px; font-weight:bold;">ğŸ”¥ Báº£ng Ä‘iá»u khiá»ƒn cáº£nh bÃ¡o chÃ¡y</h1>

<!-- NHIá»†T Äá»˜ -->
<div class="card" id="tempCard">
    <h2>ğŸŒ¡ Nhiá»‡t Ä‘á»™</h2>
    <div id="tempValue" style="font-size:26px; font-weight:bold;">Äang táº£i...</div>
</div>

<!-- KHÃ“I -->
<div class="card" id="smokeCard">
    <h2>ğŸ’¨ Má»©c Ä‘á»™ khÃ³i</h2>
    <div id="smokeValue" style="font-size:26px; font-weight:bold;">Äang táº£i...</div>
</div>

<!-- NGÆ¯á» NG NHIá»†T -->
<div class="card">
    <h2>âš  NgÆ°á»¡ng nhiá»‡t Ä‘á»™</h2>
    Hiá»‡n táº¡i: <span id="thresholdValue">Äang táº£i...</span>

    <input type="number" id="newThreshold" placeholder="Nháº­p ngÆ°á»¡ng nhiá»‡t Ä‘á»™ má»›i">
    <button onclick="updateThreshold()">Cáº­p nháº­t</button>
</div>

<!-- NGÆ¯á» NG KHÃ“I -->
<div class="card">
    <h2>ğŸ’¨ NgÆ°á»¡ng khÃ³i</h2>
    Hiá»‡n táº¡i: <span id="smokeThresValue">Äang táº£i...</span>

    <input type="number" id="newSmokeThres" placeholder="Nháº­p ngÆ°á»¡ng khÃ³i má»›i">
    <button onclick="updateSmokeThreshold()">Cáº­p nháº­t</button>
</div>

<!-- BIá»‚U Äá»’ REALTIME -->
<div class="card">
    <h2>ğŸ“ˆ Biá»ƒu Ä‘á»“ nhiá»‡t Ä‘á»™ & khÃ³i (Realtime)</h2>
    <canvas id="chartJS" height="180"></canvas>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// FIREBASE CONFIG
const firebaseConfig = {
    apiKey: "AIzaSyAAoqP-5Kkw_sMJOvLzMd9yMZsto86rQBk",
    authDomain: "fire-warning-3f43e.firebaseapp.com",
    databaseURL: "https://fire-warning-3f43e-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "fire-warning-3f43e",
    storageBucket: "fire-warning-3f43e.firebasestorage.app",
    messagingSenderId: "216206579900",
    appId: "1:216206579900:web:aa5f46d236923b921418b9",
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();

// -------- BIá»‚U Äá»’ REALTIME ------------
let labels = [];
let tempData = [];
let smokeData = [];

const ctx = document.getElementById('chartJS').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels,
        datasets: [
            {
                label: "Nhiá»‡t Ä‘á»™ (Â°C)",
                data: tempData,
                borderColor: "red",
                borderWidth: 2
            },
            {
                label: "KhÃ³i",
                data: smokeData,
                borderColor: "blue",
                borderWidth: 2
            }
        ]
    },
    options: {
        scales: {
            y: { beginAtZero: true }
        }
    }
});

// HÃ m cáº­p nháº­t biá»ƒu Ä‘á»“
function addChartData(temp, smoke) {
    let now = new Date().toLocaleTimeString();

    labels.push(now);
    tempData.push(temp);
    smokeData.push(smoke);

    if (labels.length > 20) {
        labels.shift();
        tempData.shift();
        smokeData.shift();
    }

    chart.update();
}


// ----------- REALTIME TEMPERATURE ----------
let tempThreshold = 0;
db.ref("Threshold").on("value", snap => {
    tempThreshold = snap.val();
    document.getElementById("thresholdValue").innerText = snap.val();
});

db.ref("Temperature").on("value", snap => {
    let t = snap.val();
    document.getElementById("tempValue").innerHTML = t + " Â°C";

    // Cáº£nh bÃ¡o vÆ°á»£t ngÆ°á»¡ng
    let card = document.getElementById("tempCard");
    card.classList.toggle("alert", t >= tempThreshold);

    addChartData(t, null);
});

// ----------- REALTIME SMOKE ----------
let smokeThreshold = 0;
db.ref("SmokeThreshold").on("value", snap => {
    smokeThreshold = snap.val();
    document.getElementById("smokeThresValue").innerText = snap.val();
});

db.ref("Smoke").on("value", snap => {
    let s = snap.val();
    document.getElementById("smokeValue").innerHTML = s;

    let card = document.getElementById("smokeCard");
    card.classList.toggle("alert", s >= smokeThreshold);

    addChartData(null, s);
});

// ----------- UPDATE THRESHOLD -----------
function updateThreshold() {
    let input = document.getElementById("newThreshold");
    if (input.value === "") return alert("Nháº­p giÃ¡ trá»‹!");

    db.ref("Threshold").set(Number(input.value));
    input.value = "";
}

// ----------- UPDATE SMOKE THRESHOLD -----
function updateSmokeThreshold() {
    let input = document.getElementById("newSmokeThres");
    if (input.value === "") return alert("Nháº­p giÃ¡ trá»‹!");

    db.ref("SmokeThreshold").set(Number(input.value));
    input.value = "";
}
</script>

</body>
</html>
