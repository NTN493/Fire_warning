<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H·ªá Th·ªëng C·∫£nh B√°o Ch√°y Th√¥ng Minh</title>

<style>
    :root {
        --bg: #f0f2f5;
        --card: #ffffff;
        --primary: #d32f2f;
        --accent: #007bff;
        --ok: #28a745;
        --danger: #ff4d4d;
        --radius: 18px;
        --shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    * { box-sizing: border-box; }

    body {
        font-family: "Segoe UI", sans-serif;
        background: #f7f7fa;
        margin: 0; padding: 20px;
    }

    h1 {
        text-align: center;
        color: var(--primary);
        margin-bottom: 25px;
        font-size: 28px;
        font-weight: 700;
        letter-spacing: 1px;
    }

    .status-wrapper {
        text-align: center;
        margin-bottom: 25px;
    }

    .status-badge {
        padding: 8px 20px;
        border-radius: 999px;
        color: #fff;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(0,0,0,0.15);
        display: inline-block;
    }

    .status-online { background: var(--ok); }
    .status-offline { background: var(--danger); }

    .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        max-width: 980px;
        margin: 0 auto;
    }

    @media(max-width:768px) {
        .container { grid-template-columns: 1fr; }
    }

    .card {
        background: var(--card);
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        text-align: center;
        transition: 0.3s;
    }

    .value {
        font-size: 40px;
        font-weight: 700;
        margin-top: 15px;
    }

    .unit { font-size: 20px; }

    .status-text {
        margin-top: 5px;
        font-size: 15px;
        color: #666;
    }

    .divider {
        width: 100%;
        height: 1px;
        background: #eee;
        margin: 18px 0;
    }

    .threshold-value {
        font-size: 18px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .control-group {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    input[type=number] {
        padding: 10px 14px;
        width: 60%;
        border-radius: 12px;
        border: 1px solid #ccc;
        font-size: 16px;
    }

    button {
        background: var(--accent);
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: bold;
    }

    .alert {
        background-color: #ff6a6a !important;
        color: #fff !important;
        box-shadow: 0 0 20px rgba(255,0,0,0.5);
    }

    .alert .value,
    .alert .threshold-value {
        color: #fff !important;
        text-shadow: 0 0 10px #fff;
    }
</style>
</head>

<body>

<h1>üî• H·ªÜ TH·ªêNG C·∫¢NH B√ÅO CH√ÅY TH√îNG MINH</h1>

<div class="status-wrapper">
    <span id="connectionStatus" class="status-badge status-offline">üî¥ M·∫•t k·∫øt n·ªëi</span>
</div>

<div class="container">

    <!-- Nhi·ªát ƒë·ªô -->
    <div class="card" id="tempCard">
        <h2>üå° Nhi·ªát ƒë·ªô</h2>
        <div class="value" id="tempValue">--<span class="unit">¬∞C</span></div>
        <div class="status-text" id="tempStatus">ƒêang t·∫£i...</div>
        <div class="divider"></div>
        <div class="threshold-value" id="thresTemp">-- ¬∞C</div>

        <div class="control-group">
            <input type="number" id="newTempThres" placeholder="Ng∆∞·ª°ng m·ªõi...">
            <button onclick="saveThreshold('Temperature')">L∆∞u</button>
        </div>
    </div>

    <!-- Kh√≥i -->
    <div class="card" id="smokeCard">
        <h2>üí® N·ªìng ƒë·ªô Kh√≥i</h2>
        <div class="value" id="smokeValue">--<span class="unit">ppm</span></div>
        <div class="status-text" id="smokeStatus">ƒêang t·∫£i...</div>
        <div class="divider"></div>
        <div class="threshold-value" id="thresSmoke">-- ppm</div>

        <div class="control-group">
            <input type="number" id="newSmokeThres" placeholder="Ng∆∞·ª°ng m·ªõi...">
            <button onclick="saveThreshold('Smoke')">L∆∞u</button>
        </div>
    </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// --- FIREBASE CONFIG ---
const firebaseConfig = {
    apiKey: "AIzaSyAAoqP-5Kkw_sMJOvLzMd9yMZsto86rQBk",
    authDomain: "fire-warning-3f43e.firebaseapp.com",
    databaseURL: "https://fire-warning-3f43e-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "fire-warning-3f43e",
    storageBucket: "fire-warning-3f43e.firebasestorage.app",
    messagingSenderId: "216206579900",
    appId: "1:216206579900:web:aa5f46d236923b921418b9"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- State ---
let lastUpdate = 0;
const timeoutLimit = 12000;

// --- Helpers ---
function updateCard(cardId, valueId, statusId, thres, value) {
    const card = document.getElementById(cardId);

    document.getElementById(valueId).innerHTML =
        value + (valueId.includes("temp") ? "<span class='unit'>¬∞C</span>" : "<span class='unit'>ppm</span>");

    if (value >= thres) {
        card.classList.add("alert");
        document.getElementById(statusId).innerText = "‚ö†Ô∏è NGUY HI·ªÇM!";
    } else {
        card.classList.remove("alert");
        document.getElementById(statusId).innerText = "B√¨nh th∆∞·ªùng";
    }
}

// --- Listen Temperature ---
db.ref("Temperature").on("value", snapshot => {
    const v = snapshot.val();
    if (v == null) return;
    lastUpdate = Date.now();
    updateCard("tempCard", "tempValue", "tempStatus", limits.temp, v);
});

// --- Listen Smoke ---
db.ref("Smoke").on("value", snapshot => {
    const v = snapshot.val();
    if (v == null) return;
    lastUpdate = Date.now();
    updateCard("smokeCard", "smokeValue", "smokeStatus", limits.smoke, v);
});

// --- Limits ---
let limits = { temp: 100, smoke: 100 };

// Load limits
db.ref("Threshold").on("value", s => {
    limits.temp = s.val();
    document.getElementById("thresTemp").innerText = limits.temp + " ¬∞C";
});
db.ref("SmokeThreshold").on("value", s => {
    limits.smoke = s.val();
    document.getElementById("thresSmoke").innerText = limits.smoke + " ppm";
});

// Save thresholds
function saveThreshold(type) {
    let input;
    let path;

    if (type === "Temperature") {
        input = document.getElementById("newTempThres");
        path = "Threshold";
    } else {
        input = document.getElementById("newSmokeThres");
        path = "SmokeThreshold";
    }

    const val = Number(input.value);
    if (!val) return alert("Nh·∫≠p gi√° tr·ªã h·ª£p l·ªá!");

    db.ref(path).set(val);
    input.value = "";
}

// --- Connection Status ---
setInterval(() => {
    const badge = document.getElementById("connectionStatus");

    if (Date.now() - lastUpdate < timeoutLimit) {
        badge.classList.remove("status-offline");
        badge.classList.add("status-online");
        badge.innerText = "üü¢ ƒêang k·∫øt n·ªëi";
    } else {
        badge.classList.remove("status-online");
        badge.classList.add("status-offline");
        badge.innerText = "üî¥ M·∫•t k·∫øt n·ªëi";
    }
}, 1000);
</script>

</body>
</html>
