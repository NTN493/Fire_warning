<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng C·∫£nh B√°o Ch√°y Th√¥ng Minh</title>
   
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #d32f2f;
            margin-bottom: 30px;
            text-transform: uppercase;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
        /* CARD */
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
        }
        .card h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #444;
        }
        .value-display {
            font-size: 40px;
            font-weight: bold;
            margin: 5px 0 10px 0;
        }
        .status-text {
            font-size: 14px;
            color: #666;
        }
        .threshold-box {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .threshold-box input {
            width: 65%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .threshold-box button {
            padding: 10px 15px;
            border: none;
            background: #1976d2;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 5px;
        }
        /* M√†u cho gi√° tr·ªã ng∆∞·ª°ng (b√¨nh th∆∞·ªùng ƒë·ªè) */
        .threshold-value {
            color: red;
            font-weight: bold;
        }
        /* Alert ch·ªâ cho ph·∫ßn sensor-section */
       .alert-mode {
            background-color: #ff4d4d !important;
            color: white !important;
            animation: pulse 1.5s infinite;
        }
       
        /* Ch·ªâ ƒë·ªïi m√†u cho c√°c th√†nh ph·∫ßn hi·ªÉn th·ªã trong sensor-section */
        .alert-mode h2,
        .alert-mode .value-display,
        .alert-mode .status-text {
            color: white !important;
        }
        /* Animation pulse */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        /* ƒê·∫£m b·∫£o √¥ nh·∫≠p li·ªáu lu√¥n c√≥ ch·ªØ m√†u ƒëen ƒë·ªÉ d·ªÖ nh√¨n */
        .threshold-box input {
            color: #333 !important;
            background-color: #fff !important;
        }
        /* Status badge */
        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        .status-offline { background: #d32f2f; }
        .status-online { background: #2e7d32; }
    </style>
</head>
<body>
    <h1>üî• H·ªá Th·ªëng C·∫£nh B√°o Ch√°y Th√¥ng Minh</h1>
    <div style="text-align:center; margin-bottom: 20px;">
        <span id="connectionStatus" class="status-badge status-offline">üî¥ ƒêang t√¨m thi·∫øt b·ªã...</span>
    </div>
    <div class="container">
        <!-- NHI·ªÜT ƒê·ªò -->
        <div class="card">
            <div class="sensor-section" id="tempSensor">
                <h2>üå° Nhi·ªát ƒë·ªô</h2>
                <div class="value-display" id="tempValue">-- ¬∞C</div>
                <div class="status-text" id="tempStatus">ƒêang t·∫£i...</div>
            </div>
            <div class="threshold-box">
                <div>Ng∆∞·ª°ng hi·ªán t·∫°i: <b id="thresTemp" class="threshold-value">--</b></div>
                <input type="number" id="newThresTemp" placeholder="M·ª©c c·∫£nh b√°o...">
                <button onclick="updateVal('Threshold','newThresTemp')">L∆∞u</button>
            </div>
        </div>
        <!-- KH√ìI -->
        <div class="card">
            <div class="sensor-section" id="smokeSensor">
                <h2>üí® N·ªìng ƒë·ªô kh√≥i</h2>
                <div class="value-display" id="smokeValue">-- ppm</div>
                <div class="status-text" id="smokeStatus">ƒêang t·∫£i...</div>
            </div>
            <div class="threshold-box">
                <div>Ng∆∞·ª°ng hi·ªán t·∫°i: <b id="thresSmoke" class="threshold-value">--</b></div>
                <input type="number" id="newThresSmoke" placeholder="M·ª©c c·∫£nh b√°o...">
                <button onclick="updateVal('SmokeThreshold','newThresSmoke')">L∆∞u</button>
            </div>
        </div>
        <!-- GAS -->
        <div class="card">
            <div class="sensor-section" id="gasSensor">
                <h2>‚ò† N·ªìng ƒë·ªô Gas</h2>
                <div class="value-display" id="gasValue">-- ppm</div>
                <div class="status-text" id="gasStatus">ƒêang t·∫£i...</div>
            </div>
            <div class="threshold-box">
                <div>Ng∆∞·ª°ng hi·ªán t·∫°i: <b id="thresGas" class="threshold-value">--</b></div>
                <input type="number" id="newThresGas" placeholder="M·ª©c c·∫£nh b√°o...">
                <button onclick="updateVal('GasThreshold','newThresGas')">L∆∞u</button>
            </div>
        </div>
        <!-- L·ª¨A -->
        <div class="card">
            <div class="sensor-section" id="flameSensor">
                <h2>üî• C·∫£m bi·∫øn l·ª≠a</h2>
                <div class="value-display" id="flameValue">--</div>
                <div class="status-text" id="flameStatus">ƒêang t·∫£i...</div>
            </div>
            <div class="threshold-box">
                <div>Ng∆∞·ª°ng hi·ªán t·∫°i: <b id="thresFlame" class="threshold-value">--</b></div>
                <input type="number" id="newThresFlame" placeholder="M·ª©c c·∫£nh b√°o...">
                <button onclick="updateVal('FlameThreshold','newThresFlame')">L∆∞u</button>
            </div>
        </div>
    </div>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAAoqP-5Kkw_sMJOvLzMd9yMZsto86rQBk",
            authDomain: "fire-warning-3f43e.firebaseapp.com",
            databaseURL: "https://fire-warning-3f43e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fire-warning-3f43e",
            storageBucket: "fire-warning-3f43e.firebasestorage.app",
            messagingSenderId: "216206579900",
            appId: "1:216206579900:web:aa5f46d236923b921418b9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let data = { temp:0, smoke:0, gas:0, flame:0 };
        let limits = { temp:100, smoke:100, gas:100, flame:100 };
        let lastUpdate = 0;
        const timeoutLimit = 12000;
        function updateUI(type, val, limit, sensorId, valueId, statusId, unit) {
            document.getElementById(valueId).innerText = val + (unit ? " " + unit : "");
            let sensorSection = document.getElementById(sensorId);
            let status = document.getElementById(statusId);
            let alert =
                (type === "flame") ? (val < limit) : (val >= limit);
            if (alert) { 
                sensorSection.classList.add("alert-mode"); 
                status.innerText = "‚ö†Ô∏è NGUY HI·ªÇM!!!"; 
            }
            else { 
                sensorSection.classList.remove("alert-mode"); 
                status.innerText = "B√¨nh th∆∞·ªùng"; 
            }
            lastUpdate = Date.now();
        }
        // Listener c·∫£m bi·∫øn
        db.ref("Temperature").on("value", snap => {
            data.temp = snap.val() || 0;
            updateUI("temp", data.temp, limits.temp, "tempSensor", "tempValue", "tempStatus", "¬∞C");
        });
        db.ref("Smoke").on("value", snap => {
            data.smoke = snap.val() || 0;
            updateUI("smoke", data.smoke, limits.smoke, "smokeSensor", "smokeValue", "smokeStatus", "ppm");
        });
        db.ref("Gas").on("value", snap => {
            data.gas = snap.val() || 0;
            updateUI("gas", data.gas, limits.gas, "gasSensor", "gasValue", "gasStatus", "ppm");
        });
        db.ref("Flame").on("value", snap => {
            data.flame = snap.val() || 0;
            updateUI("flame", data.flame, limits.flame, "flameSensor", "flameValue", "flameStatus", "");
        });
        // Listener ng∆∞·ª°ng
        db.ref("Threshold").on("value", snap => {
            limits.temp = snap.val();
            document.getElementById("thresTemp").innerText = limits.temp;
        });
        db.ref("SmokeThreshold").on("value", snap => {
            limits.smoke = snap.val();
            document.getElementById("thresSmoke").innerText = limits.smoke;
        });
        db.ref("GasThreshold").on("value", snap => {
            limits.gas = snap.val();
            document.getElementById("thresGas").innerText = limits.gas;
        });
        db.ref("FlameThreshold").on("value", snap => {
            limits.flame = snap.val();
            document.getElementById("thresFlame").innerText = limits.flame;
        });
        function updateVal(path, inputId) {
            let val = document.getElementById(inputId).value;
            if (val) {
                db.ref(path).set(Number(val));
                alert("ƒê√£ l∆∞u th√†nh c√¥ng!");
                document.getElementById(inputId).value = "";
            }
        }
        // K·∫øt n·ªëi tr·∫°ng th√°i
        setInterval(() => {
            let badge = document.getElementById("connectionStatus");
            if (Date.now() - lastUpdate < timeoutLimit) {
                badge.className = "status-badge status-online";
                badge.innerText = "üü¢ ƒêang k·∫øt n·ªëi";
            } else {
                badge.className = "status-badge status-offline";
                badge.innerText = "üî¥ M·∫•t k·∫øt n·ªëi";
            }
        }, 1000);
    </script>
</body>
</html>
